tinymce.PluginManager.requireLangPack("codemirror");
tinymce.PluginManager.add("codemirror", function(e, o) {
	function r() {
		e.focus();
		e.selection.collapse(true);
		if (e.settings.codemirror.saveCursorPosition) {
			e.selection.setContent('<span style="display: none;" class="CmCaReT">&#x0;</span>')
		}
		var r = 800;
		if (e.settings.codemirror.width) {
			r = e.settings.codemirror.width
		}
		var t = 550;
		if (e.settings.codemirror.height) {
			t = e.settings.codemirror.height
		}
		var i = tinymce.majorVersion < 5 ? [{
			text: "Ok",
			subtype: "primary",
			onclick: function() {
				var e = document.querySelectorAll(".mce-container-body>iframe")[0];
				e.contentWindow.submit();
				c.close()
			}
		}, {
			text: "Cancel",
			onclick: "close"
		}] : [{
			type: "custom",
			text: "Ok",
			name: "codemirrorOk",
			primary: true
		}, {
			type: "cancel",
			text: "Cancel",
			name: "codemirrorCancel"
		}];
		var n = {
			title: "HTML source code",
			url: o + "/source.html",
			width: r,
			height: t,
			resizable: true,
			maximizable: true,
			fullScreen: e.settings.codemirror.fullscreen,
			saveCursorPosition: false,
			buttons: i
		};
		if (tinymce.majorVersion >= 5) {
			n.onAction = function(o, r) {
				if (r.name === "codemirrorOk") {
					var t = document.querySelectorAll(".tox-dialog__body-iframe iframe")[0];
					t.contentWindow.submit();
					e.undoManager.add();
					c.close()
				}
			}
		}
		var c = tinymce.majorVersion < 5 ? e.windowManager.open(n) : e.windowManager.openUrl(n);
	}
	if (tinymce.majorVersion < 5) {
		e.addButton("code", {
			title: "Source code",
			icon: "code",
			onclick: r
		});
		e.addMenuItem("code", {
			icon: "code",
			text: "Source code",
			context: "tools",
			onclick: r
		})
	} else {
		e.ui.registry.addButton("code", {
			icon: "sourcecode",
			title: "Source code",
			tooltip: "Source code",
			onAction: r
		});
		e.ui.registry.addMenuItem("code", {
			icon: "sourcecode",
			text: "Source code",
			onAction: r,
			context: "tools"
		})
	}
});